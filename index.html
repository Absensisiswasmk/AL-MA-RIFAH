<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Absen Digital SMKS AL-MA'RIFAH GEMPOL</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .btn-primary {
            background: linear-gradient(45deg, #4f46e5, #7c3aed);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(79, 70, 229, 0.3);
        }
        .status-hadir { background-color: #10b981; }
        .status-izin { background-color: #f59e0b; }
        .status-sakit { background-color: #ef4444; }
        .status-absen { background-color: #6b7280; }
        .status-bolos { background-color: #dc2626; }
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #4f46e5;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 12px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        .toast.show {
            transform: translateX(0);
        }
        .toast.success { background-color: #10b981; }
        .toast.error { background-color: #ef4444; }
        .toast.info { background-color: #3b82f6; }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full bg-gray-50">
  <div id="app" class="min-h-full"><!-- Header -->
   <header class="gradient-bg text-white shadow-lg">
    <div class="max-w-7xl mx-auto px-4 py-6">
     <div class="flex items-center justify-between">
      <div class="flex items-center space-x-4"><!-- Logo Sekolah -->
       <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center">
        <svg class="w-10 h-10 text-indigo-600" fill="currentColor" viewbox="0 0 24 24"><path d="M12 3L1 9l4 2.18v6L12 21l7-3.82v-6l2-1.09V17h2V9L12 3zm6.82 6L12 12.72 5.18 9 12 5.28 18.82 9zM17 15.99l-5 2.73-5-2.73v-3.72L12 15l5-2.73v3.72z" />
        </svg>
       </div>
       <div>
        <h1 id="school-name" class="text-2xl font-bold">SMKS AL-MA'RIFAH GEMPOL</h1>
        <p id="school-address" class="text-indigo-100">Jl.Pejagan Asem 02/01 Ds.kedung bunder Kec.Gempol Kab.Cirebon 45161</p>
       </div>
      </div>
      <div class="text-right">
       <h2 id="app-title" class="text-xl font-semibold">Sistem Absensi Digital</h2>
       <p class="text-indigo-100" id="current-date"></p>
      </div>
     </div>
    </div>
   </header><!-- Navigation -->
   <nav class="bg-white shadow-sm border-b">
    <div class="max-w-7xl mx-auto px-4">
     <div class="flex space-x-8"><button onclick="showPage('attendance')" class="nav-btn py-4 px-6 text-indigo-600 border-b-2 border-indigo-600 font-medium"> üìù Absensi </button> <button onclick="showPage('reports')" class="nav-btn py-4 px-6 text-gray-500 hover:text-indigo-600 font-medium"> üìä Laporan </button>
     </div>
    </div>
   </nav><!-- Main Content -->
   <main class="max-w-7xl mx-auto px-4 py-8"><!-- Attendance Page -->
    <div id="attendance-page" class="page-content"><!-- Controls -->
     <div class="bg-white rounded-lg card-shadow p-6 mb-8">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
       <div><label class="block text-sm font-medium text-gray-700 mb-2">Kelas</label> <select id="class-select" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"> <option value="X">Kelas X</option> <option value="XI-1">Kelas XI-1</option> <option value="XI-2">Kelas XI-2</option> <option value="XII">Kelas XII</option> </select>
       </div>
       <div><label class="block text-sm font-medium text-gray-700 mb-2">Mata Pelajaran</label> <select id="subject-select" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"> <option value="Bahasa Indonesia">Bahasa Indonesia</option> <option value="Pend. Pancasila">Pend. Pancasila</option> <option value="Matematika">Matematika</option> <option value="Sejarah">Sejarah</option> <option value="Bahasa Inggris">Bahasa Inggris</option> <option value="PAI">PAI</option> <option value="Bahasa Jepang">Bahasa Jepang</option> <option value="Seni Rupa">Seni Rupa</option> <option value="AIJ">AIJ</option> <option value="PKK">PKK</option> <option value="Penjas">Penjas</option> <option value="Dasar Program Keahlian">Dasar Program Keahlian</option> <option value="Adm Sistem Jaringan">Adm Sistem Jaringan</option> <option value="Sistem Komputer">Sistem Komputer</option> <option value="IPAS">IPAS</option> <option value="Informatika">Informatika</option> <option value="Teklajar">Teklajar</option> <option value="IOT">IOT</option> <option value="Digital Marketing">Digital Marketing</option> </select>
       </div>
       <div><label class="block text-sm font-medium text-gray-700 mb-2">Guru</label> <select id="teacher-select" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"> <option value="Muhamad Saefullah,S.Kom">Muhamad Saefullah,S.Kom</option> <option value="Lili Muzdalifah,S.Kom,Gr">Lili Muzdalifah,S.Kom,Gr</option> <option value="Narjiman,S.Pd.i,Gr">Narjiman,S.Pd.i,Gr</option> <option value="Afandi Jarkasi,S.Kom,MM,Gr">Afandi Jarkasi,S.Kom,MM,Gr</option> <option value="Nani Sumarni,S.Pd.i,Gr">Nani Sumarni,S.Pd.i,Gr</option> <option value="Aan Hermawan,S.Kom">Aan Hermawan,S.Kom</option> <option value="Hafip Zaenudin,S.Kom">Hafip Zaenudin,S.Kom</option> <option value="Tatang Sujana,S.Kom">Tatang Sujana,S.Kom</option> <option value="Abdullah Khaeru Ramadhan,S.Kom">Abdullah Khaeru Ramadhan,S.Kom</option> <option value="Muhammad Syafiq Farhan,S.Pd">Muhammad Syafiq Farhan,S.Pd</option> <option value="Aminah,SE,M.Pd">Aminah,SE,M.Pd</option> <option value="Nihayatul Khusniah,S.Pd">Nihayatul Khusniah,S.Pd</option> <option value="Nida Lyalin,S.Pd">Nida Lyalin,S.Pd</option> <option value="Siti Markhamah,S.Pd">Siti Markhamah,S.Pd</option> <option value="Rizal Ainnur Rahman,S.Kom">Rizal Ainnur Rahman,S.Kom</option> <option value="Ilva Minatika,Amd.Kom">Ilva Minatika,Amd.Kom</option> <option value="Nati Yulia Sari,SE">Nati Yulia Sari,SE</option> <option value="Fauzi Ramdani">Fauzi Ramdani</option> <option value="Undi Erlangga,SS">Undi Erlangga,SS</option> </select>
       </div>
       <div><label class="block text-sm font-medium text-gray-700 mb-2">Jam Ke</label> <input type="number" id="time-slot" min="1" max="10" value="1" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
       </div>
      </div>
      <div class="flex flex-wrap gap-4 mb-6"><button onclick="markAllPresent()" class="btn-primary text-white px-6 py-2 rounded-md font-medium flex items-center space-x-2"> <span>‚úÖ</span> <span>Hadir Semua</span> </button> <button onclick="saveAttendance()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-md font-medium flex items-center space-x-2"> <span id="save-spinner" class="loading-spinner hidden"></span> <span>üíæ</span> <span>Simpan Absen</span> </button> <button onclick="exportToPDF()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md font-medium flex items-center space-x-2"> <span>üìÑ</span> <span>Ekspor PDF</span> </button> <button onclick="showAddStudentModal()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-md font-medium flex items-center space-x-2"> <span>üë§</span> <span>Tambah Siswa</span> </button>
      </div><!-- Save Status Indicator -->
      <div id="save-status" class="hidden bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
       ‚úÖ Absensi telah disimpan pada <span id="save-timestamp"></span>
      </div>
     </div><!-- Attendance Table -->
     <div class="bg-white rounded-lg card-shadow overflow-hidden">
      <div class="px-6 py-4 border-b border-gray-200">
       <h3 class="text-lg font-semibold text-gray-900">Daftar Absensi - <span id="current-class">Kelas X</span></h3>
      </div>
      <div class="overflow-x-auto">
       <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
         <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">No</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Siswa</th>
          <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Hadir</th>
          <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Izin</th>
          <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Sakit</th>
          <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Absen</th>
          <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Bolos</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Keterangan</th>
          <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
         </tr>
        </thead>
        <tbody id="attendance-table" class="bg-white divide-y divide-gray-200"><!-- Table content will be populated by JavaScript -->
        </tbody>
       </table>
      </div>
     </div>
    </div><!-- Reports Page -->
    <div id="reports-page" class="page-content hidden">
     <div class="bg-white rounded-lg card-shadow p-6">
      <h3 class="text-xl font-semibold text-gray-900 mb-6">üìä Laporan Kehadiran</h3><!-- Report Filters -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
       <div><label class="block text-sm font-medium text-gray-700 mb-2">Kelas</label> <select id="report-class" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"> <option value="">Semua Kelas</option> <option value="X">Kelas X</option> <option value="XI-1">Kelas XI-1</option> <option value="XI-2">Kelas XI-2</option> <option value="XII">Kelas XII</option> </select>
       </div>
       <div><label class="block text-sm font-medium text-gray-700 mb-2">Periode</label> <select id="report-period" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"> <option value="daily">Harian</option> <option value="weekly">Mingguan</option> <option value="monthly">Bulanan</option> <option value="yearly">Tahunan</option> </select>
       </div>
       <div><label class="block text-sm font-medium text-gray-700 mb-2">Tanggal</label> <input type="date" id="report-date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
       </div>
      </div>
      <div class="flex flex-wrap gap-4 mb-6"><button onclick="generateReport()" class="btn-primary text-white px-6 py-2 rounded-md font-medium"> üîç Generate Laporan </button> <button onclick="exportReportPDF()" class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-md font-medium"> üìÑ Ekspor PDF </button> <button onclick="deleteAllReports()" class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-md font-medium"> üóëÔ∏è Hapus Semua Laporan </button>
      </div><!-- Report Results -->
      <div id="report-results" class="hidden">
       <h4 class="text-lg font-semibold text-gray-900 mb-4">Hasil Laporan</h4>
       <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
         <thead class="bg-gray-50">
          <tr>
           <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama</th>
           <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Kelas</th>
           <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Hadir</th>
           <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Izin</th>
           <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Sakit</th>
           <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Absen</th>
           <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Bolos</th>
           <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
          </tr>
         </thead>
         <tbody id="report-table" class="bg-white divide-y divide-gray-200"><!-- Report content will be populated by JavaScript -->
         </tbody>
        </table>
       </div>
      </div>
     </div>
    </div>
   </main>
  </div><!-- Add Student Modal -->
  <div id="add-student-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden flex items-center justify-center z-50">
   <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
    <h3 class="text-lg font-semibold text-gray-900 mb-4">Tambah Siswa Baru</h3>
    <form id="add-student-form" onsubmit="addNewStudent(event)">
     <div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-2">Nama Siswa</label> <input type="text" id="new-student-name" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
     </div>
     <div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-2">Kelas</label> <select id="new-student-class" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"> <option value="X">Kelas X</option> <option value="XI-1">Kelas XI-1</option> <option value="XI-2">Kelas XI-2</option> <option value="XII">Kelas XII</option> </select>
     </div>
     <div class="flex justify-end space-x-4"><button type="button" onclick="hideAddStudentModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50"> Batal </button> <button type="submit" class="btn-primary text-white px-4 py-2 rounded-md"> Tambah Siswa </button>
     </div>
    </form>
   </div>
  </div>
  <script>
        // Default configuration
        const defaultConfig = {
            school_name: "SMKS AL-MA'RIFAH GEMPOL",
            school_address: "Jl.Pejagan Asem 02/01 Ds.kedung bunder Kec.Gempol Kab.Cirebon 45161",
            app_title: "Sistem Absensi Digital"
        };

        // Student data by class
        const studentsByClass = {
            'X': [
                'AKMAL WIRDANSAH', 'AMANDA SISKA FIRINA', 'ARIANI MUTIA ATMANAGARA', 'ARINA NABILATUZ ZAHRA',
                'AUFA ABDUL MUTHI', 'AULIA IZZATUNISA', 'AURELL LUQMAN', 'BANU RAZIQ YUSUF',
                'DEDE SOBARI', 'DIANA HADAWIYAH', 'FERI ARDIANSYAH', 'HABIB DZAKI AWALUL SULTON',
                'HIKMAH ROHMATILLAH', 'INTAN MAHARANI', 'JESIKA ANGGRAENI', 'M. HAIKAL RIZKI',
                'MUHAMAD IKHSAN', 'M. JARKASI NUR', 'M. SYARIF HIDAYATULLAH', 'NISHREEN NAZILAH MUMTAZAH',
                'NURUL ARIF RAHMAN', 'PUTRA HABIBURROHMAN', 'RENDI JAMIL AFRIYANDI', 'SAEPUL RAMDAN',
                'SLAMET RIYADI', 'SYEKH HAKIN NAJELI', 'SYIFA SALSABILA AS-SHOFI', 'YOGA BAGUS SADEWO',
                'M. RIZKI MAULANA'
            ],
            'XI-1': [
                'AGHISNA HELMALIA AZMI', 'ALDI HARDIANSYAH', 'ALYA LAUDYA HAMZAH', 'ANISA RAHMADANI ASTORI',
                'ATEP ALIYUDIN', 'CAWIDANA', 'ICHA MINATUL MAULA', 'ICHA VARIATUN NISA',
                'IMAM MAHDI AL-GHOZALI', 'INDRI LESTARI', 'IQTIDAR ZAAIDAN', 'KAMALIA AL KAISA',
                'LUTHFIYAH PUTRI', 'M. CHAMALIN', 'M. PRADITYA FAKHRI ASYAWALI', 'M. WILDAN FIRDAUS',
                'NAZWA SYAFIRA', 'SAHRUL ALWI', 'TIYAS NUR KHOTIMAH', 'TRIO ANFAUL MU\'MIN',
                'TSANIATUL WADA\'I', 'VAIZUL LAILATURRAHMAN', 'WIDYA PUTRI'
            ],
            'XI-2': [
                'ABDUL ISFARON KHOIR', 'ABDUL ROZAQ', 'AUDI ALFARIZI', 'BAYU MAKDIS DARUSSALAM',
                'FITRI APRILIYANI', 'HADZELLIYA FEBRIANI', 'HAFIZ AHMAD FATAH', 'INAYATUL DZIL IZZATI',
                'IRWAN DERMAWAN', 'ISMATURROHMAN', 'JAKA', 'JAYA',
                'KEYLA MAUDI ANGGRAENI', 'MAULANA IMRON', 'MUHAEMIN FATRUROJI', 'M. APIVI',
                'M. ASROR FATHONY', 'M. RIZAL FADLI', 'M. ZIO RAMADHANI', 'NAJMA LAILA',
                'RIZKI MAULANA', 'SARIFA ANIS', 'WIWIN WAHYUDI', 'M. NUR ROYYAN'
            ],
            'XII': [
                'AA KURNIAWAN', 'AFNAN IRSYAD ARDIANSYAH', 'AGNI TRISA PUTRI', 'AHNAF',
                'ANDINI', 'ANJANI SALSABILA', 'ARDILA RIZKA MIRANTI', 'ARIF RAHMAT',
                'DEDE ARYAN', 'ELVAN FAUZAN AHMAD AL ANSHORI', 'FAJAR AFRIYADI', 'FITRA FADILLAH',
                'HUZROTUN NISA', 'ILHAM MAULANA', 'INDRI NOVA DIYANA', 'IQBAL SAEFULLAH',
                'KURNIAWAN', 'M.FAQIH', 'MUHAMMAD FAJAR', 'M. SYARIF HASAN',
                'NADA SAFFANAH BILQIES', 'NINA KHOEROTUN NISA', 'RIDHO FEBRIAN', 'ROMADONI SAEFUDIN',
                'SITI ROIHANATUL AMALIYAH'
            ]
        };

        // Global variables
        let attendanceData = [];
        let currentRecordCount = 0;

        // Data handler for SDK
        const dataHandler = {
            onDataChanged(data) {
                attendanceData = data;
                currentRecordCount = data.length;
                updateAttendanceTable();
            }
        };

        // Initialize SDK and app
        async function initializeApp() {
            try {
                const initResult = await window.dataSdk.init(dataHandler);
                if (!initResult.isOk) {
                    showToast('Gagal menginisialisasi sistem data', 'error');
                    return;
                }

                // Initialize Element SDK
                if (window.elementSdk) {
                    await window.elementSdk.init({
                        defaultConfig,
                        onConfigChange: async (config) => {
                            document.getElementById('school-name').textContent = config.school_name || defaultConfig.school_name;
                            document.getElementById('school-address').textContent = config.school_address || defaultConfig.school_address;
                            document.getElementById('app-title').textContent = config.app_title || defaultConfig.app_title;
                        },
                        mapToCapabilities: (config) => ({
                            recolorables: [],
                            borderables: [],
                            fontEditable: undefined,
                            fontSizeable: undefined
                        }),
                        mapToEditPanelValues: (config) => new Map([
                            ["school_name", config.school_name || defaultConfig.school_name],
                            ["school_address", config.school_address || defaultConfig.school_address],
                            ["app_title", config.app_title || defaultConfig.app_title]
                        ])
                    });
                }

                updateCurrentDate();
                updateAttendanceTable();
                setInterval(updateCurrentDate, 60000);
            } catch (error) {
                showToast('Terjadi kesalahan saat menginisialisasi aplikasi', 'error');
            }
        }

        // Update current date display
        function updateCurrentDate() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                timeZone: 'Asia/Jakarta'
            };
            document.getElementById('current-date').textContent = now.toLocaleDateString('id-ID', options);
            
            // Set report date to today
            document.getElementById('report-date').value = now.toISOString().split('T')[0];
        }

        // Show/hide pages
        function showPage(page) {
            document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-indigo-600', 'border-b-2', 'border-indigo-600');
                btn.classList.add('text-gray-500');
            });

            document.getElementById(`${page}-page`).classList.remove('hidden');
            event.target.classList.remove('text-gray-500');
            event.target.classList.add('text-indigo-600', 'border-b-2', 'border-indigo-600');

            if (page === 'reports') {
                generateReport();
            }
        }

        // Update attendance table
        function updateAttendanceTable() {
            const selectedClass = document.getElementById('class-select').value;
            const students = studentsByClass[selectedClass] || [];
            const tableBody = document.getElementById('attendance-table');
            
            document.getElementById('current-class').textContent = `Kelas ${selectedClass}`;
            
            tableBody.innerHTML = '';
            
            students.forEach((student, index) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${index + 1}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${student}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                        <input type="radio" name="status_${index}" value="hadir" class="text-green-600 focus:ring-green-500" checked>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                        <input type="radio" name="status_${index}" value="izin" class="text-yellow-600 focus:ring-yellow-500">
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                        <input type="radio" name="status_${index}" value="sakit" class="text-red-600 focus:ring-red-500">
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                        <input type="radio" name="status_${index}" value="absen" class="text-gray-600 focus:ring-gray-500">
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                        <input type="radio" name="status_${index}" value="bolos" class="text-red-800 focus:ring-red-500">
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <input type="text" id="notes_${index}" placeholder="Keterangan..." class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-indigo-500">
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                        <button onclick="deleteStudent('${selectedClass}', ${index})" class="text-red-600 hover:text-red-800 text-sm font-medium">
                            üóëÔ∏è Hapus
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // Mark all students as present
        function markAllPresent() {
            const radios = document.querySelectorAll('input[type="radio"][value="hadir"]');
            radios.forEach(radio => radio.checked = true);
            showToast('Semua siswa ditandai hadir', 'success');
        }

        // Save attendance data
        async function saveAttendance() {
            if (currentRecordCount >= 999) {
                showToast('Batas maksimum 999 data tercapai. Hapus beberapa data terlebih dahulu.', 'error');
                return;
            }

            const saveSpinner = document.getElementById('save-spinner');
            saveSpinner.classList.remove('hidden');

            const selectedClass = document.getElementById('class-select').value;
            const subject = document.getElementById('subject-select').value;
            const teacher = document.getElementById('teacher-select').value;
            const timeSlot = document.getElementById('time-slot').value;
            const students = studentsByClass[selectedClass] || [];
            
            const currentDate = new Date().toISOString().split('T')[0];
            const currentTime = new Date().toISOString();

            try {
                for (let i = 0; i < students.length; i++) {
                    const statusRadio = document.querySelector(`input[name="status_${i}"]:checked`);
                    const notes = document.getElementById(`notes_${i}`).value;
                    
                    if (statusRadio) {
                        const attendanceRecord = {
                            id: `${selectedClass}_${i}_${currentDate}_${timeSlot}`,
                            student_name: students[i],
                            class_name: selectedClass,
                            subject: subject,
                            teacher: teacher,
                            date: currentDate,
                            time_slot: timeSlot,
                            status: statusRadio.value,
                            notes: notes,
                            created_at: currentTime
                        };

                        const result = await window.dataSdk.create(attendanceRecord);
                        if (!result.isOk) {
                            throw new Error(`Gagal menyimpan data untuk ${students[i]}`);
                        }
                    }
                }

                // Show save status
                const saveStatus = document.getElementById('save-status');
                const saveTimestamp = document.getElementById('save-timestamp');
                saveTimestamp.textContent = new Date().toLocaleString('id-ID');
                saveStatus.classList.remove('hidden');

                showToast('Absensi berhasil disimpan!', 'success');
            } catch (error) {
                showToast('Gagal menyimpan absensi: ' + error.message, 'error');
            } finally {
                saveSpinner.classList.add('hidden');
            }
        }

        // Export to PDF
        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const selectedClass = document.getElementById('class-select').value;
            const subject = document.getElementById('subject-select').value;
            const teacher = document.getElementById('teacher-select').value;
            const currentDate = new Date().toLocaleDateString('id-ID');
            
            // Header
            doc.setFontSize(16);
            doc.text('SMKS AL-MA\'RIFAH GEMPOL', 20, 20);
            doc.setFontSize(12);
            doc.text('Jl.Pejagan Asem 02/01 Ds.kedung bunder Kec.Gempol Kab.Cirebon 45161', 20, 30);
            
            doc.setFontSize(14);
            doc.text('DAFTAR ABSENSI SISWA', 20, 50);
            
            doc.setFontSize(10);
            doc.text(`Kelas: ${selectedClass}`, 20, 65);
            doc.text(`Mata Pelajaran: ${subject}`, 20, 75);
            doc.text(`Guru: ${teacher}`, 20, 85);
            doc.text(`Tanggal: ${currentDate}`, 20, 95);
            
            // Table
            const students = studentsByClass[selectedClass] || [];
            let yPos = 110;
            
            doc.text('No', 20, yPos);
            doc.text('Nama Siswa', 35, yPos);
            doc.text('Status', 120, yPos);
            doc.text('Keterangan', 150, yPos);
            
            yPos += 10;
            doc.line(20, yPos - 5, 190, yPos - 5);
            
            students.forEach((student, index) => {
                const statusRadio = document.querySelector(`input[name="status_${index}"]:checked`);
                const notes = document.getElementById(`notes_${index}`).value;
                const status = statusRadio ? statusRadio.value.toUpperCase() : 'HADIR';
                
                doc.text((index + 1).toString(), 20, yPos);
                doc.text(student, 35, yPos);
                doc.text(status, 120, yPos);
                doc.text(notes || '-', 150, yPos);
                
                yPos += 8;
                
                if (yPos > 270) {
                    doc.addPage();
                    yPos = 20;
                }
            });
            
            doc.save(`Absensi_${selectedClass}_${currentDate.replace(/\//g, '-')}.pdf`);
            showToast('PDF berhasil diunduh!', 'success');
        }

        // Show add student modal
        function showAddStudentModal() {
            document.getElementById('add-student-modal').classList.remove('hidden');
        }

        // Hide add student modal
        function hideAddStudentModal() {
            document.getElementById('add-student-modal').classList.add('hidden');
            document.getElementById('add-student-form').reset();
        }

        // Add new student
        function addNewStudent(event) {
            event.preventDefault();
            
            const name = document.getElementById('new-student-name').value.trim();
            const className = document.getElementById('new-student-class').value;
            
            if (name && className) {
                if (!studentsByClass[className].includes(name)) {
                    studentsByClass[className].push(name);
                    updateAttendanceTable();
                    hideAddStudentModal();
                    showToast(`Siswa ${name} berhasil ditambahkan ke kelas ${className}`, 'success');
                } else {
                    showToast('Siswa dengan nama tersebut sudah ada di kelas ini', 'error');
                }
            }
        }

        // Delete student
        function deleteStudent(className, index) {
            const studentName = studentsByClass[className][index];
            
            // Create inline confirmation
            const row = event.target.closest('tr');
            const actionCell = row.querySelector('td:last-child');
            
            actionCell.innerHTML = `
                <div class="flex space-x-2">
                    <button onclick="confirmDeleteStudent('${className}', ${index})" class="bg-red-600 text-white px-2 py-1 rounded text-xs">
                        Konfirmasi Hapus
                    </button>
                    <button onclick="updateAttendanceTable()" class="bg-gray-600 text-white px-2 py-1 rounded text-xs">
                        Batal
                    </button>
                </div>
            `;
        }

        // Confirm delete student
        function confirmDeleteStudent(className, index) {
            const studentName = studentsByClass[className][index];
            studentsByClass[className].splice(index, 1);
            updateAttendanceTable();
            showToast(`Siswa ${studentName} berhasil dihapus`, 'success');
        }

        // Generate report
        function generateReport() {
            const reportClass = document.getElementById('report-class').value;
            const reportPeriod = document.getElementById('report-period').value;
            const reportDate = document.getElementById('report-date').value;
            
            let filteredData = attendanceData;
            
            // Filter by class
            if (reportClass) {
                filteredData = filteredData.filter(record => record.class_name === reportClass);
            }
            
            // Filter by period
            if (reportDate) {
                const selectedDate = new Date(reportDate);
                filteredData = filteredData.filter(record => {
                    const recordDate = new Date(record.date);
                    
                    switch (reportPeriod) {
                        case 'daily':
                            return recordDate.toDateString() === selectedDate.toDateString();
                        case 'weekly':
                            const weekStart = new Date(selectedDate);
                            weekStart.setDate(selectedDate.getDate() - selectedDate.getDay());
                            const weekEnd = new Date(weekStart);
                            weekEnd.setDate(weekStart.getDate() + 6);
                            return recordDate >= weekStart && recordDate <= weekEnd;
                        case 'monthly':
                            return recordDate.getMonth() === selectedDate.getMonth() && 
                                   recordDate.getFullYear() === selectedDate.getFullYear();
                        case 'yearly':
                            return recordDate.getFullYear() === selectedDate.getFullYear();
                        default:
                            return true;
                    }
                });
            }
            
            // Group by student
            const studentStats = {};
            filteredData.forEach(record => {
                const key = `${record.student_name}_${record.class_name}`;
                if (!studentStats[key]) {
                    studentStats[key] = {
                        name: record.student_name,
                        class: record.class_name,
                        hadir: 0,
                        izin: 0,
                        sakit: 0,
                        absen: 0,
                        bolos: 0
                    };
                }
                studentStats[key][record.status]++;
            });
            
            // Display results
            const reportTable = document.getElementById('report-table');
            reportTable.innerHTML = '';
            
            Object.values(studentStats).forEach(stats => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${stats.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-center">${stats.class}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-center">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                            ${stats.hadir}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-center">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                            ${stats.izin}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-center">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                            ${stats.sakit}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-center">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                            ${stats.absen}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-center">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-200 text-red-900">
                            ${stats.bolos}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                        <button onclick="deleteStudentReport('${stats.name}', '${stats.class}')" class="text-red-600 hover:text-red-800 text-sm font-medium">
                            üóëÔ∏è Hapus
                        </button>
                    </td>
                `;
                
                reportTable.appendChild(row);
            });
            
            document.getElementById('report-results').classList.remove('hidden');
        }

        // Delete student report
        async function deleteStudentReport(studentName, className) {
            try {
                const recordsToDelete = attendanceData.filter(record => 
                    record.student_name === studentName && record.class_name === className
                );
                
                for (const record of recordsToDelete) {
                    const result = await window.dataSdk.delete(record);
                    if (!result.isOk) {
                        throw new Error(`Gagal menghapus data ${studentName}`);
                    }
                }
                
                showToast(`Data absensi ${studentName} berhasil dihapus`, 'success');
                generateReport();
            } catch (error) {
                showToast('Gagal menghapus data: ' + error.message, 'error');
            }
        }

        // Export report to PDF
        function exportReportPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const reportClass = document.getElementById('report-class').value;
            const reportPeriod = document.getElementById('report-period').value;
            const reportDate = document.getElementById('report-date').value;
            
            // Header
            doc.setFontSize(16);
            doc.text('SMKS AL-MA\'RIFAH GEMPOL', 20, 20);
            doc.setFontSize(12);
            doc.text('LAPORAN KEHADIRAN SISWA', 20, 35);
            
            doc.setFontSize(10);
            doc.text(`Kelas: ${reportClass || 'Semua Kelas'}`, 20, 50);
            doc.text(`Periode: ${reportPeriod}`, 20, 60);
            doc.text(`Tanggal: ${reportDate}`, 20, 70);
            
            // Table header
            let yPos = 85;
            doc.text('Nama', 20, yPos);
            doc.text('Kelas', 60, yPos);
            doc.text('Hadir', 90, yPos);
            doc.text('Izin', 110, yPos);
            doc.text('Sakit', 130, yPos);
            doc.text('Absen', 150, yPos);
            doc.text('Bolos', 170, yPos);
            
            yPos += 10;
            doc.line(20, yPos - 5, 190, yPos - 5);
            
            // Table data
            const rows = document.querySelectorAll('#report-table tr');
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length > 0) {
                    doc.text(cells[0].textContent, 20, yPos); // Name
                    doc.text(cells[1].textContent, 60, yPos); // Class
                    doc.text(cells[2].textContent, 90, yPos); // Hadir
                    doc.text(cells[3].textContent, 110, yPos); // Izin
                    doc.text(cells[4].textContent, 130, yPos); // Sakit
                    doc.text(cells[5].textContent, 150, yPos); // Absen
                    doc.text(cells[6].textContent, 170, yPos); // Bolos
                    
                    yPos += 8;
                    
                    if (yPos > 270) {
                        doc.addPage();
                        yPos = 20;
                    }
                }
            });
            
            const filename = `Laporan_Kehadiran_${reportPeriod}_${reportDate.replace(/-/g, '')}.pdf`;
            doc.save(filename);
            showToast('Laporan PDF berhasil diunduh!', 'success');
        }

        // Delete all reports
        async function deleteAllReports() {
            if (attendanceData.length === 0) {
                showToast('Tidak ada data untuk dihapus', 'info');
                return;
            }

            // Create inline confirmation
            const button = event.target;
            const originalText = button.innerHTML;
            
            button.innerHTML = '‚ö†Ô∏è Konfirmasi Hapus Semua?';
            button.onclick = async () => {
                try {
                    for (const record of attendanceData) {
                        const result = await window.dataSdk.delete(record);
                        if (!result.isOk) {
                            throw new Error('Gagal menghapus beberapa data');
                        }
                    }
                    
                    showToast('Semua data laporan berhasil dihapus', 'success');
                    document.getElementById('report-results').classList.add('hidden');
                } catch (error) {
                    showToast('Gagal menghapus data: ' + error.message, 'error');
                } finally {
                    button.innerHTML = originalText;
                    button.onclick = deleteAllReports;
                }
            };
            
            // Reset after 5 seconds
            setTimeout(() => {
                button.innerHTML = originalText;
                button.onclick = deleteAllReports;
            }, 5000);
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }

        // Event listeners
        document.getElementById('class-select').addEventListener('change', updateAttendanceTable);

        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99e70a2202373e32',t:'MTc2MzEyODg3My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>